generator client {
  provider = "prisma-client-js"
  output   = "../app/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Dpt {
  id      BigInt    @id
  name    String
  status  DptStatus @default(BELUM_MEMILIH)
  kelasId Int

  // Relations
  kelas     Kelas      @relation(fields: [kelasId], references: [id])
  bilik     Bilik?     @relation("BilikCurrentDpt")
  perolehan Perolehan?

  updatedAt DateTime @default(now()) @updatedAt

  activityLogs ActivityLog[]
}

enum DptStatus {
  BELUM_MEMILIH
  DALAM_ANTRIAN
  DALAM_BILIK
  SUDAH_MEMILIH
}

model Kelas {
  id   Int    @id
  name String

  // Relations
  dpt Dpt[]
}

model Paslon {
  id      Int    @id
  image   String
  ketos   String
  waketos String

  // Relations
  perolehan Perolehan[]
}

model Bilik {
  id           Int     @id
  name         String
  currentDptId BigInt? @unique

  // Relations
  currentDpt Dpt?        @relation("BilikCurrentDpt", fields: [currentDptId], references: [id])
  perolehan  Perolehan[]

  activityLogs ActivityLog[]
}

model Perolehan {
  id       Int    @id
  dptId    BigInt @unique
  bilikId  Int
  paslonId Int

  // Relations
  dpt    Dpt    @relation(fields: [dptId], references: [id])
  bilik  Bilik  @relation(fields: [bilikId], references: [id])
  paslon Paslon @relation(fields: [paslonId], references: [id])
}

model ActivityLog {
  id        Int          @id @default(autoincrement())
  type      ActivityType
  message   String
  dptId     BigInt?
  bilikId   Int?
  createdAt DateTime     @default(now())

  dpt   Dpt?   @relation(fields: [dptId], references: [id])
  bilik Bilik? @relation(fields: [bilikId], references: [id])
}

enum ActivityType {
  ADD_QUEUE
  REMOVE_QUEUE
  ENTER_BILIK
  REMOVE_BILIK
  COMPLETE_VOTE
  SYSTEM
}
